---
title: "Causal Quartet Data Work"
output:
      html_document:
        keep_md: true
---

### Required libraries

```{r setup, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggdag)
library(dagitty)
library(episensr) 
library(quartets)
library(reportRmd)
library(tidyverse)
library(knitr)
library(epitools)
```

This data work class is based on the paper below and the [`quartets`](https://r-causal.github.io/quartets/#causal-quartet) R package. We will be working through some examples from the quartets package, specifically Anscombe's Quartet and the Causal Quartet. The examples are precisely the one's provided in the paper and in the package but I will add some explanation and discussion to the data work. 

  *  Lucy D’Agostino McGowan, Travis Gerke & Malcolm Barrett (2023) Causal Inference Is Not Just a Statistics Problem, Journal of Statistics and Data Science Education, DOI: 10.1080/26939169.2023.2276446. 
  
### Anscombe's Quartet

From the `quartets` package and [wiki](https://en.wikipedia.org/wiki/Anscombe%27s_quartet)

> The goal of the anscombe_quartet data set is to help drive home the point that visualizing your data is important. Francis Anscombe generated these four datasets to demonstrate that statistical summary measures alone cannot capture the full relationship between two variables (here, x and y). Anscombe emphasized the importance of visualizing data prior to calculating summary statistics.

* Dataset 1 has a linear relationship between x and y
* Dataset 2 has shows a nonlinear relationship between x and y
* Dataset 3 has a linear relationship between x and y with a single outlier
* Dataset 4 has shows no relationship between x and y with a single outlier that serves as a high-leverage point

### Load the data

```{r}
anscombe <- anscombe_quartet
```

### Summary statistics

Let's generate summary statistics for the data. Remember that this dataset was generated by a person to show why we should visualize our data. 

```{r}
anscombe_summary <- anscombe_quartet %>%
                      group_by(dataset) %>%
                      summarise(mean_x = mean(x),
                                var_x = var(x),
                                mean_y = mean(y),
                                var_y = var(y),
                                cor = cor(x, y)) 

kable(anscombe_summary, digits = 2)
```

Ok wow. If we look at the summary statistics they are all exactly the same. For each for the 4 datasets the mean and variance of x and y are the same, and the correlation between x and y is the same. This extends basically to all summary statistics, regression coefficients, whatever you want to calculate. 

### Visualize the data

Here we are doing a scatter plot between x and y grouped by dataset. 

```{r}
ggplot(anscombe_quartet, aes(x = x, y = y)) +
  geom_point() + 
  geom_smooth(method = "lm", formula = "y ~ x") +
  facet_wrap(~dataset) + 
  theme_classic()
```

The data visualization shows that the datasets are very different in terms of the actual relationship between x and y. Anscombe's Quartet has been modernized into the [`DataSaurus Dozen`](https://cran.r-project.org/web/packages/datasauRus/index.html)... because why not. 

### Visualize the DataSaurus Dozen data

```{r}
ggplot(datasaurus_dozen, aes(x = x, y = y)) +
  geom_point() + 
  geom_smooth(method = "lm", formula = "y ~ x") +
  facet_wrap(~dataset) +
  theme_classic()
```

That was fun! 

```{}
If you want you can calculate the summary statistics and correlations as a practice.
```

## Causal Quartet

Now will work on the causal quartet data. From the R package repo

> The goal of the causal_quartet data set is to help drive home the point that when presented with an exposure, outcome, and some measured factors, statistics alone, whether summary statistics or data visualizations, are not sufficient to determine the appropriate causal estimate. Additional information about the data generating mechanism is needed in order to draw the correct conclusions. 

Instead of 4 different relationships, as in the Anscombe's quartet data, we have 4 different types of potential mechanisms that might bias our results

1. Collider
2. Confounder
3. Mediator
4. M-Bias 

The causal quartet contains 100 simulated data points from each of the four mechanisms. This set of figures demonstrates that despite the very different data-generating mechanisms, there is no clear way to determine the “appropriate” way to model the effect of the exposure X and the outcome Y without additional information. The information below is combined from tables 1 and 2 from the paper.

| Technical term | Explanation | True Association | Correct causal model / analysis | 
| ----- | ----- | ----- | ----- |
| Collider | The exposure, X, causes a factor, Z, and the outcome, Y, causes a factor, Z. Adjusting for Z when estimating the effect of X on Y would yield a biased result. | Y ~ X | 1 | 

